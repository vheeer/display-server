(window.MIP=window.MIP||[]).push({name:"mip-form",func:function(){define("mip-form/mip-form-fn",["require","templates","util","viewer"],function(t){var e,i=t("templates"),n=t("util"),r=t("viewer"),o=r.isIframed,s={EMAIL:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,PHONE:/^1\d{10}$/,IDCAR:/^\d{15}|\d{18}$/};return{fetchUrl:function(t){var e=this;n.css([e.successEle,e.errorEle],{display:"none"});var i={method:e.method,credentials:"include"};if("POST"===e.method){var r=e.ele.querySelector("form");if(r)i=n.fn.extend({},i,{body:new FormData(r)})}fetch(t,i).then(function(t){if(t.ok)e.submitSuccessHandle(),t.json().then(function(t){n.css(e.successEle,{display:"block"}),e.renderTpl(e.successEle,t)}).catch(function(t){e.fetchReject(t)});else e.submitErrorHandle(),e.fetchReject({})}).catch(function(t){e.submitErrorHandle(),e.fetchReject(t)})},fetchReject:function(t){var e=this;n.css(e.errorEle,{display:"block"}),e.renderTpl(e.errorEle,t)},renderTpl:function(t,e){var n=this;i.render(t,e).then(function(e){n.tempHTML(t).innerHTML=e})},tempHTML:function(t){t=t||document;var e=t.querySelector("[mip-mustache-rendered]");if(!e)e=n.dom.create("<div mip-mustache-rendered></div>"),t.appendChild(e);return e},createDom:function(t){var i=this,o=t.getAttribute("url"),s=t.getAttribute("target"),a=document.createElement("form"),l=(t.getAttribute("method")||"GET").toUpperCase();a.action=o,a.method=l,s=s?s:"_blank",a.target=r.isIframed&&"_blank"!==s?"_top":s,t.appendChild(a),n.dom.insert(a,t.children);var c=t.querySelectorAll("form");Array.prototype.forEach.call(c,function(n){n.addEventListener("submit",function(n){n.preventDefault(),e=n,i.onSubmit(t,n)})}),t.addEventListener("keydown",function(t){if(13===t.keyCode)e=t,t.preventDefault(),i.onSubmit(this)},!1)},sendFormMessage:function(t){if(o)r.sendMessage("input-"+t,{})},initMessageEvents:function(t){var e=this,i=t.querySelectorAll("input");Array.prototype.forEach.call(i,function(t,i){t.addEventListener("focus",function(){e.sendFormMessage("focus")},!1),t.addEventListener("blur",function(){e.sendFormMessage("blur")},!1)})},verification:function(t,e){return"must"===t?!(""===e):s[t.toUpperCase()].test(e)},onSubmit:function(t){var e=this,i=!1,r=t.querySelectorAll("input, textarea, select"),o=t.getAttribute("url")||"",s=o.toLowerCase(),a=s.match("http://"),l="",c=t.getAttribute("fetch-url")||"";e.method=(t.getAttribute("method")||"GET").toUpperCase();var u="GET"===e.method;if(this.ele=t,this.successEle=t.querySelector("[submit-success]"),this.errorEle=t.querySelector("[submit-error]"),e.submitHandle(),Array.prototype.forEach.call(r,function(r){var o,s=r.getAttribute("validatetype"),a=r.getAttribute("validatetarget"),c=r.getAttribute("validatereg"),u=r.value;if("submit"!==r.type){if("checkbox"===r.type||"radio"===r.type)u=r.checked?r.value:"";if(l+="&"+r.name+"="+u,s){if(c)o=""===u?!1:new RegExp(c).test(u);else o=e.verification(s,u);n.css(t.querySelectorAll('div[target="'+a+'"]'),{display:!o?"block":"none"}),i=!o?!0:i}}}),!i)if(window.parent!==window&&a&&u){var d="";if(s.match("\\?"))d=s+l;else l=l.substring(1),d=s+"?"+l;var f={event:"mibm-jumplink",data:{url:d}};window.parent.postMessage(f,"*")}else if(c.trim())e.fetchUrl(c);else t.getElementsByTagName("form")[0].submit()},submitHandle:function(){r.eventAction.execute("submit",e.target,e)},submitSuccessHandle:function(){if(e)r.eventAction.execute("submitSuccess",e.target,e)},submitErrorHandle:function(){if(e)r.eventAction.execute("submitError",e.target,e)}}}),define("mip-form/mip-form",["require","customElement","util","./mip-form-fn"],function(t){var e=t("customElement").create(),i=t("util"),n=t("./mip-form-fn");return e.prototype.build=function(){function t(t){t.stopPropagation(),t.preventDefault();var e=t.target.getAttribute("name"),n=c.parentNode.querySelector('input[name="'+e+'"]');n.focus(),n.value="",i.css(c,{display:"none"})}var e=this.element,r=e.hasAttribute("clear");if(n.createDom(e),r){var o=["text","input","datetime","email","number","search","tel","url"],s="";for(var a in o)s+=",input[type="+o[a]+"]";s=s.slice(1);var l=e.querySelectorAll(s);if(!l.length)return;var c=document.createElement("div");c.id="mip-form-cross",this.cross=c;for(var u=0;u<l.length;u++){var d=l[u].offsetHeight;l[u].addEventListener("focus",function(){var t=this;if(c.setAttribute("name",t.getAttribute("name")),i.css(c,{top:t.offsetTop+(d-16)/2-8+"px",left:t.offsetWidth-32+"px"}),t.parentNode.appendChild(c),""!==t.value)i.css(c,{display:"block"});else i.css(c,{display:"none"}),t.addEventListener("input",function(){if(!(i&&i.platform&&i.platform.isAndroid()&&"search"===t.type))i.css(c,{display:""!==t.value?"block":"none"})})},!1),l[u].addEventListener("blur",function(){i.css(c,{display:"none"})},!1)}c.addEventListener("touchstart",t,!1),c.addEventListener("mousedown",t,!1),c.addEventListener("click",t,!1)}n.initMessageEvents(e)},e}),define("mip-form",["mip-form/mip-form"],function(t){return t}),function(){function t(t,e){t.registerMipElement("mip-form",e,"mip-form{position:relative}mip-form #mip-form-cross{position:absolute;display:block;padding:6px;width:20px;height:20px;right:0;background:url(//m.baidu.com/static/search/clear.png) no-repeat center;z-index:100;background-size:100% 100%;background-origin:content-box;-webkit-tap-highlight-color:rgba(0,0,0,0.4);tap-highlight-color:rgba(0,0,0,0.4)}mip-form input,mip-form textarea,mip-form select{border:1px solid #f1f1f1;padding:6px;display:block;box-sizing:border-box;-webkit-box-sizing:border-box;resize:none;font-size:16px}mip-form input[type='text'],mip-form input[type='input'],mip-form input[type='datetime'],mip-form input[type='email'],mip-form input[type='number'],mip-form input[type='tel'],mip-form input[type='url']{padding-right:30px}mip-form form{position:relative}mip-form input[type='radio']{display:inline}mip-form label{display:block}mip-form div{display:none;color:#ec1f5c;font-size:12px;text-align:left;padding:0 10% 0 3%}mip-form div[mip-mustache-rendered]{display:block}mip-form input[type='submit']{border:1px solid #f1f1f1;border-radius:5px;color:#333;background-color:#d8d7d7}mip-form [submit-success],mip-form [submit-error]{display:none}")}if(window.MIP)require(["mip-form"],function(e){t(window.MIP,e)});else require(["mip","mip-form"],t)}()}});